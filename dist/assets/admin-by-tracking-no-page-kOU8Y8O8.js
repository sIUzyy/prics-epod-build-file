import{j as e,P as r,r as m,d as D,t as f}from"./index-B_BwmF1n.js";import{D as k,P,S as T,V as h,I as x,p as q,T as u,b as E,c as O}from"./index-BktrINDk.js";import{a as I}from"./table-headers-NmVF5Ah3.js";import{A}from"./arrow-down-to-line-B19n4dsi.js";import{L}from"./loading-table-DjlKue5T.js";import{L as F}from"./loading-card-lYlcRtwa.js";import{H as S}from"./page-heading-Dndd7_7V.js";import{C as y,a as g,b as j,c as b}from"./card-O2QYhjHN.js";import{a as v}from"./index-DW_MHI2K.js";import{H as B}from"./hash-_Xs3Yqmk.js";import{T as H}from"./truck-BpLaWtiy.js";import"./tslib.es6-Cz-Yey_7.js";import"./createLucideIcon-DOLBm2BF.js";import"./utils-9LinqH4U.js";import"./clsx-B-dksMZM.js";window.Buffer=E.Buffer;const c=T.create({page:{padding:10},section:{marginBottom:20},logo:{width:150,height:85,objectFit:"cover",objectPosition:"center"},header:{fontSize:18,fontWeight:"bold",marginBottom:5},label:{fontSize:10,marginVertical:5,fontWeight:"bold"}});function _({selectedProductCode:d,preDeliveryData:o}){const t=o.flatMap(i=>i.pre_delivery_products.filter(a=>a.productCode===d)).flatMap(i=>i.uploadedImages||[]).filter((i,a,s)=>s.indexOf(i)===a);return e.jsx(k,{children:e.jsxs(P,{size:"A4",style:c.page,children:[e.jsxs(h,{style:c.section,children:[e.jsx(x,{src:q,style:c.logo}),e.jsx(u,{style:c.header,children:"ELECTRONIC PROOF OF DELIVERY (e-POD) ATTACHED FILE"})]}),o.length>0&&e.jsxs(u,{style:c.label,children:["TRACKING NUMBER: ",o[0].pre_delivery_trackingNo]}),e.jsxs(u,{style:c.label,children:["PRODUCT CODE: ",d]}),t.length>0&&e.jsx(h,{style:{marginVertical:10},children:t.map((i,a)=>e.jsx(x,{src:`https://prics-epod-backend.onrender.com/${i}`,style:{width:400,height:300,objectFit:"contain",marginBottom:5}},a))})]})})}_.propTypes={selectedProductCode:r.string.isRequired,preDeliveryData:r.arrayOf(r.shape({pre_delivery_trackingNo:r.string.isRequired,pre_delivery_products:r.arrayOf(r.shape({productCode:r.string.isRequired,receivedQty:r.number.isRequired,remarks:r.string.isRequired})).isRequired})).isRequired};function C({data:d,preDeliveryData:o}){return e.jsx("div",{className:"table_section font-inter w-full mt-5  ",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"-m-1.5 overflow-x-auto",children:e.jsx("div",{className:"p-1.5 min-w-full inline-block align-middle",children:e.jsxs("div",{className:"border rounded-lg divide-y divide-gray-200",children:[e.jsx("div",{className:"py-5 px-4"}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"th-user-table",children:e.jsx("tr",{children:I.map((t,i)=>e.jsx("th",{className:"px-6 py-3",children:t},i))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:d.map((t,i)=>{const a=o.find(s=>s.pre_delivery_trackingNo===t.trackingNo);return e.jsxs("tr",{className:i%2===0?"bg-[#F3F4F6]":"",children:[e.jsx("td",{className:"td-admin-table  ",children:i+1}),e.jsx("td",{className:"td-admin-table ",children:t.productCode}),e.jsx("td",{className:"td-admin-table ",children:t.description}),e.jsx("td",{className:"td-admin-table ",children:t.shippedQty}),e.jsxs("td",{className:"td-admin-table ",children:[t.total_cbm_per_item," kg"]}),e.jsx("td",{className:"td-admin-table ",children:a?a.pre_delivery_products.filter(s=>s.productCode===t.productCode).map(s=>s.receivedQty?s.receivedQty:"-"):"-"}),e.jsx("td",{className:"td-admin-table ",children:a?a.pre_delivery_products.filter(s=>s.productCode===t.productCode).map(s=>s.remarks&&s.remarks.trim()!==""?s.remarks.toLowerCase():"-"):"-"}),e.jsx("td",{className:"td-admin-table flex justify-center",title:"Download Product Code",children:e.jsx(O,{document:e.jsx(_,{preDeliveryData:o.map(s=>({...s,pre_delivery_products:(s.pre_delivery_products||[]).filter(l=>l.productCode===t.productCode)})).filter(s=>s.pre_delivery_products.length>0),selectedProductCode:t.productCode}),fileName:`${t.productCode}_ATTACHED_FILE.pdf`,children:e.jsx(A,{size:20,className:"text-indigo-500 outline-none"})})})]},t._id)})})]})})]})})})})})}C.propTypes={data:r.arrayOf(r.shape({_id:r.string.isRequired,trackingNo:r.string.isRequired,productCode:r.string.isRequired,description:r.string.isRequired,shippedQty:r.number.isRequired,total_cbm_per_item:r.number.isRequired,delivery_status:r.string})).isRequired,preDeliveryData:r.arrayOf(r.shape({pre_delivery_trackingNo:r.string.isRequired,pre_delivery_products:r.arrayOf(r.shape({productCode:r.string.isRequired,receivedQty:r.number.isRequired,remarks:r.string.isRequired})).isRequired})).isRequired};const N="https://prics-epod-backend.onrender.com";function te(){const[d,o]=m.useState([]),[t,i]=m.useState([]),[a,s]=m.useState(!1),{id:l}=D();return m.useEffect(()=>{l&&(async()=>{s(!0);try{s(!0);const n=await v.get(`${N}/api/productcode/${l}`);o(n.data.productCodes||[])}catch(n){console.error("Error fetching product codes:",n),f.error("We could not load your customer order data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{s(!1)}})()},[l]),m.useEffect(()=>{if(d.length===0)return;(async()=>{try{const n=d.map(p=>v.get(`${N}/api/pre-delivery/${p.trackingNo}`)),w=(await Promise.all(n)).map(p=>p.data);i(w)}catch(n){console.error("Failed to fetch pre-delivery data:",n),f.error("We could not load your pre-delivery data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}})()},[d]),e.jsxs("div",{className:"my-5 mx-4",children:[e.jsx(S,{title:`dashboard > ${l}`,description:"Below is an overview of customer orders per tracking number."}),a?e.jsxs("div",{children:[e.jsx(F,{}),e.jsx(L,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-x-3",children:[e.jsxs(y,{className:"min-w-[400px] min-h-[150]",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex justify-between items-center ",children:[e.jsx(j,{className:"font-inter text-base font-medium",children:"Tracking Number"}),e.jsx(B,{size:20})]})}),e.jsx(b,{children:e.jsx("h1",{className:"text-5xl font-bebas tracking-wider",children:l})})]}),e.jsxs(y,{className:"min-w-[400px] min-h-[150]",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex justify-between items-center ",children:[e.jsx(j,{className:"font-inter text-base font-medium",children:"Total Customer Orders"}),e.jsx(H,{size:25})]})}),e.jsx(b,{children:e.jsx("h1",{className:"text-5xl font-bebas tracking-wider",children:d.length>0?d.length:0})})]})]}),e.jsx(C,{data:d,preDeliveryData:t})]})]})}export{te as default};
