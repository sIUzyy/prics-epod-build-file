import{r as l,j as e}from"./index-B_BwmF1n.js";import{L as v}from"./loading-spinner-B8jMO9FB.js";import{B as w}from"./BrowserQRCodeReader-CDf4JARu.js";import{d as o,u as b,t as A}from"./timezone-DcS6W5tV.js";import{a as M}from"./index-DW_MHI2K.js";import{H as D}from"./page-heading-Dndd7_7V.js";o.extend(b);o.extend(A);const T="https://prics-epod-backend.onrender.com";function I(){const[g,f]=l.useState([]),[d,c]=l.useState(!1),[,u]=l.useState(!1),[y,n]=l.useState(""),p=l.useRef(null),j=async()=>{c(!0),n("");try{const t={video:{facingMode:{exact:"environment"}}};await navigator.mediaDevices.getUserMedia(t);const s=new w;if(!p.current){n("An unexpected error occurred while accessing the video."),c(!1);return}s.decodeFromVideoDevice(void 0,p.current,(r,i)=>{if(r){c(!1);const m=r.getText();N(m),s.reset()}else i&&i.name})}catch(t){console.error("Scanner Initialization Error:",t),n("Camera access is blocked. Please allow camera permissions and try again."),c(!1)}},N=async t=>{var s,r,i,m,h;if(u(!0),n(""),!t){n("No appointment ID found. Please try again."),u(!1);return}try{const a=await M.patch(`${T}/api/appointment/${t}/time-in`);a.status===200&&(f([a.data.appointment]),setTimeout(()=>{window.location.reload()},5e3))}catch(a){if(((s=a.response)==null?void 0:s.status)===400){const x=(i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message;n(x==="Appointment ID already exists in the system."?"Appointment ID already exists in the system.":x==="This appointment is not scheduled for today."?"This appointment is not scheduled for today. Please check the date.":x==="Time-in already recorded"?"Time-in has already been recorded for this appointment.":"Failed to update scan. Try scanning again."),(m=a.response.data)!=null&&m.appointment&&f([a.response.data.appointment])}else((h=a.response)==null?void 0:h.status)===404?n("No appointment record found. Please verify the ID and retry."):n("An unexpected error occurred. Please try again.");setTimeout(()=>{window.location.reload()},5e3)}finally{u(!1)}};return e.jsxs("div",{children:[d&&e.jsx("video",{ref:p,className:"w-full my-3 rounded-lg",autoPlay:!0,playsInline:!0}),e.jsx("button",{onClick:j,disabled:d,className:d?"w-full p-3 rounded-md bg-black text-white font-inter font-bold hover:opacity-75 transition-opacity duration-300 2xl:p-4 cursor-progress":"w-full p-3 rounded-md bg-black text-white font-inter font-bold hover:opacity-75 transition-opacity duration-300 2xl:p-4 cursor-pointer",children:d?e.jsxs("div",{className:"flex items-center justify-center gap-x-2",children:[e.jsx("span",{children:"Scanning"}),e.jsx(v,{})]}):"  Scan Barcode"}),y&&e.jsx("p",{className:"text-red-500 text-sm font-bold mt-5 text-center",children:y}),g.map((t,s)=>e.jsxs("div",{className:"my-5",children:[e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Id"}),e.jsx("input",{type:"text",value:t.appointment_id,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Date"}),e.jsx("input",{type:"text",value:o.utc(t.appointment_date).tz("Asia/Manila").format("MMMM D, YYYY"),readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Time"}),e.jsx("input",{type:"text",value:o.utc(t.appointment_time).tz("Asia/Manila").format("hh:mm A"),readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Plate No."}),e.jsx("input",{type:"text",value:t.plate_no,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Parking Slot"}),e.jsx("input",{type:"text",value:t.parking_slot,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Dock"}),e.jsx("input",{type:"text",value:t.dock,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Time In"}),e.jsx("input",{type:"text",value:t.time_in?o(t.time_in).format("MMMM D, YYYY hh:mm A"):"N/A",readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Time Out"}),e.jsx("input",{type:"text",value:t.time_out?o(t.time_out).format("MMMM D, YYYY hh:mm A"):"N/A",readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]})]},s))]})}function E(){return e.jsxs("div",{className:"m-5",children:[e.jsx(D,{title:"Time In",description:"Click the button to scan the driver's barcode for gate pass."}),e.jsx("div",{className:"max-w-[350px]",children:e.jsx(I,{})})]})}export{E as default};
