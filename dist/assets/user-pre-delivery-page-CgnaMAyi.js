import{j as e,t as D,P as t,b as Z,r}from"./index-Chad9CLA.js";import{a as ae,b as ne}from"./index-DHZCN8Wt.js";import{L as H}from"./loading-spinner-BUHlXXSt.js";import{B as Y}from"./button-BhGSMsAI.js";import{a as B}from"./index-DW_MHI2K.js";import{B as le}from"./BrowserQRCodeReader-CDf4JARu.js";import{H as ie}from"./page-heading-rmoYobWP.js";import"./iconBase-B7Hzua4b.js";import"./clsx-B-dksMZM.js";import"./utils-9LinqH4U.js";function oe(){return e.jsxs("div",{className:"heading_section",children:[e.jsx("h1",{className:"font-inter font-bold text-2xl tracking-widest",children:"Scanned Items"}),e.jsx("p",{className:"text-sm",children:"After scanning the barcode, the data will be automatically displayed here."})]})}function K({uploadedImages:n,setUploadedImages:a}){const y=i=>{const o=Array.from(i.target.files);if(o.filter(s=>s.size>10*1024*1024).length>0){D.warning("Each image must be under 10MB.",{style:{backgroundColor:"#FFA500",color:"#fff"}}),alert("Some files exceed 10MB. Please upload smaller files.");return}if(n.length+o.length>5){D.warning("You can only upload up to 5 images.",{style:{backgroundColor:"#FFA500",color:"#fff"}});return}a(s=>[...s,...o])},v=i=>{i.preventDefault();const o=Array.from(i.dataTransfer.files);if(o.filter(s=>s.size>10*1024*1024).length>0){D.warning("Each image must be under 10MB.",{style:{backgroundColor:"#FFA500",color:"#fff"}}),alert("Some files exceed 10MB. Please upload smaller files.");return}if(n.length+o.length>5){D.warning("You can only upload up to 5 images.",{style:{backgroundColor:"#FFA500",color:"#fff"}});return}a(s=>[...s,...o])},g=i=>{a(o=>o.filter((b,s)=>s!==i))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"font-work font-medium tracking-wider",children:["Upload Image ",e.jsx("span",{className:"text-gray-400",children:"*"})]}),e.jsxs("p",{className:"text-[#979090] text-sm",children:["( Max: ",5," images )"]})]}),e.jsxs("div",{className:"border mt-1 border-dashed border-gray-400 w-full font-inter rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer transition bg-gray-100 text-gray-500 hover:bg-gray-200",onDragOver:i=>i.preventDefault(),onDrop:v,children:[e.jsx("input",{type:"file",className:"hidden",accept:".jpg,.jpeg,.png",multiple:!0,onChange:y,id:"fileInput",disabled:n.length>=5}),e.jsx("label",{htmlFor:"fileInput",className:"cursor-pointer text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ae,{size:35}),e.jsx("p",{className:"text-blue-500 underline mt-2",children:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-500",children:"or drag and drop"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Max. File Size: ",10,"MB per image"]})]})})]}),e.jsx("ul",{className:"mt-3 text-sm text-gray-700",children:n.map((i,o)=>e.jsxs("li",{className:"flex justify-between items-center border-b py-1",children:[i.name,e.jsx("button",{onClick:()=>g(o),className:"text-red-500 text-xs ml-2",children:"âœ•"})]},o))})]})}K.propTypes={uploadedImages:t.arrayOf(t.object).isRequired,setUploadedImages:t.func.isRequired};function V({trackingNo:n,isScannedDataFieldEmpty:a,loadNo:m,currentDate:x,receivedBy:y,setReceivedBy:v,receivedByError:g,setReceivedByError:i,selectedProductCode:o,setSelectedProductCode:b,selectedProductCodeError:s,setSelectedProductCodeError:u,availableProductCodes:j,receivedQuantity:d,setReceivedQuantity:k,receivedQuantityError:R,setReceivedQuantityError:E,uom:_,remarks:I,setRemarks:F,remarksError:N,setRemarksError:L,uploadedImages:S,setUploadedImages:$,handleSubmit:q,isLoading:A,isButtonDisabled:C}){return e.jsxs("form",{children:[e.jsxs("div",{className:"xl:flex xl:gap-x-3 xl:mb-5",children:[e.jsxs("div",{className:"xl:w-1/2 mb-5",children:[e.jsx("label",{className:"font-work font-medium tracking-wider",children:"Tracking No."}),e.jsx("input",{value:n||"",type:"text",placeholder:"Tracking No.",className:"p-3 w-full mt-1 rounded-lg bg-gray-200 cursor-not-allowed text-gray-500 placeholder-gray-500  xl:mb-0",disabled:!0}),a&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:a})]}),e.jsxs("div",{className:"xl:w-1/2 mb-5",children:[e.jsx("label",{className:"font-work font-medium tracking-wider",children:"Load No."}),e.jsx("input",{value:m||"",type:"text",placeholder:"Load No.",className:"p-3 w-full mt-1 rounded-lg bg-gray-200 cursor-not-allowed text-gray-500 placeholder-gray-500  xl:mb-0",disabled:!0}),a&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:a})]})]}),e.jsxs("div",{className:"xl:flex xl:gap-x-3 xl:mb-5",children:[e.jsxs("div",{className:"xl:w-1/2",children:[e.jsx("label",{className:"font-work font-medium tracking-wider",children:"Received Date"}),e.jsx("input",{value:x,type:"datetime-local",className:"p-3 w-full mt-1 rounded-lg bg-gray-200 cursor-not-allowed text-gray-500 mb-5 xl:mb-0",disabled:!0})]}),e.jsxs("div",{className:"xl:w-1/2 mb-5",children:[e.jsxs("label",{className:"font-work font-medium tracking-wider",children:["Received By ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:y,onChange:f=>{v(f.target.value),g&&i("")},type:"text",placeholder:"Enter the name of the recipient.",className:"p-3 w-full mt-1 rounded-lg bg-yellow-50 focus:bg-white  xl:mb-0"}),g&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:g})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"font-work font-medium tracking-wider",children:["Product Code - Description ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative ",children:[e.jsxs("select",{className:"p-3 w-full mt-1 rounded-lg bg-yellow-50 text-gray-500 outline-0 appearance-none pr-10",value:o,onChange:f=>{b(f.target.value),s&&u("")},children:[e.jsx("option",{value:"",children:"Select Product Code"}),j.map(f=>e.jsx("option",{value:f.productCode,children:f.productCode},f.productCode))]}),e.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center pointer-events-none",children:e.jsx(ne,{size:20})})]}),a&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:a}),s&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:s})]}),e.jsxs("div",{className:"xl:flex xl:gap-x-3 xl:mb-5",children:[e.jsxs("div",{className:"xl:w-1/2 mb-5",children:[e.jsxs("label",{className:"font-work font-medium tracking-wider",children:["Received Quantity ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:d,onChange:f=>{const p=f.target.value;/^\d*$/.test(p)&&(k(p),R&&E(""))},type:"text",placeholder:"Enter the received quantity.",className:"p-3 w-full mt-1 rounded-lg bg-yellow-50 focus:bg-white xl:mb-0"}),R&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:R})]}),e.jsxs("div",{className:"xl:w-1/2 mb-5 ",children:[e.jsx("label",{className:"font-work font-medium tracking-wider",children:"UOM"}),e.jsx("input",{value:_||"",type:"text",placeholder:"UOM",className:"p-3 w-full mt-1 rounded-lg bg-gray-200 cursor-not-allowed text-gray-500 placeholder-gray-500 xl:mb-0",disabled:!0}),a&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-2 ",children:a})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"font-work font-medium tracking-wider",children:["Remarks ",e.jsx("span",{className:"text-gray-400",children:"*"})," "]}),e.jsx("textarea",{value:I,onChange:f=>{F(f.target.value),N&&L("")},placeholder:"( put 'N/A' if none ).",className:"border p-2 mt-1 border-gray-400 w-full font-inter rounded-lg h-32 resize-none overflow-hidden "}),N&&e.jsx("p",{className:"text-red-500 text-sm w-full mt-1 ",children:N})]}),e.jsx(K,{uploadedImages:S,setUploadedImages:$}),e.jsx(Y,{onClick:q,className:A?"w-full mt-5 py-6 bg-black rounded-md cursor-not-allowed opacity-70":j.length===0?"w-full mt-5 py-6 bg-[#80C497] rounded-md cursor-not-allowed":"w-full mt-5 py-6 bg-black rounded-md cursor-pointer",disabled:C,children:A?e.jsxs("div",{className:"flex items-center justify-center gap-x-2 ",children:[e.jsx("span",{children:"Loading"}),e.jsx(H,{})]}):j.length===0?e.jsx("h1",{className:"font-work tracking-widest",children:"Scan Tracking No. "}):"Submit"})]})}V.propTypes={trackingNo:t.string.isRequired,isScannedDataFieldEmpty:t.bool.isRequired,loadNo:t.string.isRequired,currentDate:t.string.isRequired,receivedBy:t.string.isRequired,setReceivedBy:t.string.isRequired,receivedByError:t.string,setReceivedByError:t.func.isRequired,selectedProductCode:t.string.isRequired,setSelectedProductCode:t.func.isRequired,selectedProductCodeError:t.string,setSelectedProductCodeError:t.func.isRequired,availableProductCodes:t.arrayOf(t.string).isRequired,receivedQuantity:t.number.isRequired,setReceivedQuantity:t.func.isRequired,receivedQuantityError:t.string,setReceivedQuantityError:t.func.isRequired,uom:t.string.isRequired,remarks:t.string,setRemarks:t.func.isRequired,remarksError:t.string,setRemarksError:t.func.isRequired,uploadedImages:t.arrayOf(t.object).isRequired,setUploadedImages:t.func.isRequired,handleSubmit:t.func.isRequired,isLoading:t.bool.isRequired,isButtonDisabled:t.bool.isRequired};const ce="84O5C65PXPEA",de=async()=>{try{return(await(await fetch(`https://api.timezonedb.com/v2.1/get-time-zone?key=${ce}&format=json&by=zone&zone=Asia/Manila`)).json()).formatted}catch(n){return console.error("Error fetching time:",n),null}},X="https://prics-epod-backend.onrender.com";function ue(){const{trackingNoData:n}=Z(),{trackingNo:a,loadNo:m,uom:x,productCodes:y=[]}=n,[v,g]=r.useState([]),[i,o]=r.useState(""),[b,s]=r.useState(""),[u,j]=r.useState(""),[d,k]=r.useState(""),[R,E]=r.useState(""),[_,I]=r.useState([]),[F,N]=r.useState(""),[L,S]=r.useState(""),[$,q]=r.useState(""),[A,C]=r.useState(""),[f,p]=r.useState(!1),[,O]=r.useState(!1),[W,Q]=r.useState(""),[G,J]=r.useState([]),U=y.filter(c=>!G.includes(c.productCode)),ee=U.length===0||f,T=r.useCallback(async()=>{O(!0);try{const c=Array.isArray(n)?n:[n];if(!c.length)return;const h=c.map(P=>B.get(`${X}/api/pre-delivery/${P.trackingNo}`)),l=(await Promise.all(h)).map(P=>P.data);g(l)}catch(c){console.error("Failed to fetch pre-delivery data:",c),D.error("We could not load your dashboard data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{O(!1)}},[n]),z=r.useCallback(async c=>{try{(await B.patch(`${X}/api/shipment/${a}/update-epod-status`,{epodStatus:c})).status===200&&console.log(`EPOD status updated to ${c}`)}catch(h){console.error(`Failed to update EPOD status to ${c}:`,h)}},[a]),te=async c=>{if(c.preventDefault(),p(!0),!a&&!m&&!u&&!x){Q("No data found. Scan barcode first."),p(!1);return}if(!u){q("Please select a product code."),p(!1);return}if(!b&&!d){N("Received by field cannot be empty."),S("Received quantity field cannot be empty."),p(!1);return}if(!b){N("Received by field cannot be empty."),p(!1);return}if(!d){S("Received quantity field cannot be empty."),p(!1);return}const h=y.find(l=>l.productCode===u),w=h?h.shippedQty:0;if(parseInt(d)>parseInt(w)){S(`Received quantity cannot exceed shipped quantity ${w}.`),p(!1);return}if(parseInt(d)<parseInt(w)){if(!R.trim()||R.toLowerCase()==="n/a"||R.toLowerCase()==="na"){C("Please provide a valid reason in the remarks when the received quantity is less than the shipped quantity."),p(!1);return}if(!window.confirm(`Received quantity is less than the shipped quantity ${w}. Do you want to proceed?`)){p(!1);return}}try{const l=new FormData;l.append("trackingNo",a),l.append("loadNo",m),l.append("receivedDate",i),l.append("receivedBy",b),l.append("productCode",u),l.append("receivedQty",d),l.append("uom",x),l.append("remarks",R),_.forEach(M=>{l.append("image",M)}),(await B.post(`${X}/api/pre-delivery/createpre-delivery`,l,{headers:{"Content-Type":"multipart/form-data"}})).status===201&&(D.success("Successfully processed!",{style:{backgroundColor:"#28a745",color:"#fff"}}),J(M=>[...M,u]),k(""),E(""),C(""),p(!1),I([]),await T())}catch(l){console.log(l),D.error("Something went wrong. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{p(!1)}};return r.useEffect(()=>{T()},[T]),r.useEffect(()=>{var c,h,w,l,P;if(v.length>0){const M=((h=(c=v[0])==null?void 0:c.pre_delivery_trackingNo)==null?void 0:h.length)||0,se=((l=(w=v[0])==null?void 0:w.pre_delivery_products)==null?void 0:l.length)||0,re=((P=n.productCodes)==null?void 0:P.length)||0;se===re?z("Delivered"):M>0&&z("In Receiving")}},[v,n.productCodes,z]),r.useEffect(()=>{const c=async()=>{const w=await de();w&&o(w)};c();const h=setInterval(c,6e4);return()=>clearInterval(h)},[]),r.useEffect(()=>{(a||m||u||x)&&Q("")},[a,m,u,x]),r.useEffect(()=>()=>{s(""),k(""),E(""),I([]),N(""),S(""),C("")},[s,k,E,I,N,S,C]),r.useEffect(()=>{s(""),s(""),k(""),E(""),I([]),N(""),S(""),C("")},[s,k,E,I,n,N,S,C]),e.jsxs("div",{className:"mt-5 py-5 px-2 rounded-md lg:w-3/5 lg:py-0 xl:w-2/3 lg:mt-0 ",children:[e.jsx(oe,{}),e.jsx("div",{className:"data_section mt-5",children:e.jsx(V,{trackingNo:a,isScannedDataFieldEmpty:W,loadNo:m,currentDate:i,receivedBy:b,setReceivedBy:s,receivedByError:F,setReceivedByError:N,selectedProductCode:u,setSelectedProductCode:j,selectedProductCodeError:$,setSelectedProductCodeError:q,availableProductCodes:U,receivedQuantity:d,setReceivedQuantity:k,receivedQuantityError:L,setReceivedQuantityError:S,uom:x,remarks:R,setRemarks:E,remarksError:A,setRemarksError:C,uploadedImages:_,setUploadedImages:I,handleSubmit:te,isLoading:f,isButtonDisabled:ee})})]})}const me="/assets/scan_items_image-Bzxghsf3.svg",fe="https://prics-epod-backend.onrender.com";function pe(){const{setTrackingNoData:n,setTrackingError:a,setTrackingLoading:m}=Z(),[x,y]=r.useState(!1),[v,g]=r.useState(""),i=r.useRef(null),o=async()=>{y(!0),g("");try{const s={video:{facingMode:{exact:"environment"}}};await navigator.mediaDevices.getUserMedia(s);const u=new le;if(!i.current){g("An unexpected error occurred while accessing the video."),y(!1);return}u.decodeFromVideoDevice(void 0,i.current,(j,d)=>{if(j){y(!1);const k=j.getText();b(k),u.reset()}else d&&d.name})}catch(s){console.error("Scanner Initialization Error:",s),g("Camera access is blocked. Please allow camera permissions and try again."),y(!1)}},b=async s=>{var u,j;if(m(!0),!s){g("No tracking number found. Please try again later."),m(!1);return}try{const d=await B.get(`${fe}/api/shipment/pre-delivery/${s}`);(u=d.data)!=null&&u.shipment?n(d.data.shipment):a("No data found for this tracking number.")}catch(d){g("Invalid barcode detected. Please scan a barcode again."),console.error("Data fetch error:",((j=d.response)==null?void 0:j.data)||d.message)}finally{m(!1)}};return r.useEffect(()=>()=>{n([]),a(""),m(!1)},[n,a,m]),e.jsxs("div",{className:"border-1 py-5 px-4 shadow-sm rounded-md lg:w-1/2 lg:max-h-fit xl:w-1/3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"heading_section",children:[e.jsx("h1",{className:"font-inter font-bold text-2xl tracking-widest",children:"Scan Items"}),e.jsx("p",{className:"text-sm",children:"Scan QR or Barcode"})]}),e.jsx("div",{className:"image_section",children:e.jsx("img",{src:me,alt:"scan-items-image"})})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-base",children:"Position the code within the scanner frame"}),x&&e.jsx("video",{ref:i,className:"w-full my-3 rounded-lg",autoPlay:!0,playsInline:!0}),e.jsx(Y,{onClick:o,disabled:x,className:x?"w-full mt-3 py-6 bg-black rounded-md cursor-not-allowed opacity-70 ":"w-full mt-3 py-6 bg-black rounded-md cursor-pointer",children:x?e.jsxs("div",{className:"flex items-center justify-center gap-x-2",children:[e.jsx("span",{children:"Scanning"}),e.jsx(H,{})]}):"Scan a Barcode"}),v&&e.jsx("p",{className:"text-red-500 text-sm font-bold mt-5 text-center",children:v})]})]})}function Se(){return e.jsxs("div",{className:"my-5 mx-4",children:[e.jsx(ie,{title:"Pre Delivery",description:"Scan the barcode of the item to begin the pre-delivery process."}),e.jsxs("div",{className:"lg:flex 2xl:gap-x-5",children:[e.jsx(pe,{}),e.jsx(ue,{})]})]})}export{Se as default};
