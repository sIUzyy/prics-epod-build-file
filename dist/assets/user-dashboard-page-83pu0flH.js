import{g as J,u as $,r as i,j as e,P as A,a as Y,t as M}from"./index-Chad9CLA.js";import{C as L,a as R,b as F,c as H}from"./card-BwenR6nc.js";import{a as k}from"./index-DW_MHI2K.js";import{d as u,u as O,t as z}from"./timezone-DS7qtbwd.js";import{U as K}from"./table-headers-NmVF5Ah3.js";import{L as G}from"./loading-table-BAb0c7Cl.js";import{L as Q}from"./loading-card-DoXf_Q8S.js";import{H as V}from"./page-heading-rmoYobWP.js";import{P as X}from"./package-BLaYj30s.js";import{C as ee}from"./calendar-check-2-BF7h1SXI.js";import"./utils-9LinqH4U.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-C2ToIokP.js";const te="a1d94f92b34749c0b4b6b980fde52e74",P=async o=>{const x=localStorage.getItem(o);if(x)return JSON.parse(x);try{const l=await k.get(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(o)}&key=${te}`);if(l.data.results.length>0){const{lat:c,lng:g}=l.data.results[0].geometry,f={lat:c,lng:g};return localStorage.setItem(o,JSON.stringify(f)),f}return null}catch(l){return console.error("Opencage geocoding failed. Please try again later:",l),null}};var S={exports:{}},se=S.exports,I;function ae(){return I||(I=1,function(o,x){(function(l,c){o.exports=c()})(se,function(){return function(l,c){c.prototype.isSameOrAfter=function(g,f){return this.isSame(g,f)||this.isAfter(g,f)}}})}(S)),S.exports}var re=ae();const W=J(re);u.extend(O);u.extend(z);u.extend(W);const T="Asia/Manila";function B({data:o,preDeliveryData:x}){const{selectedWarehouse:l}=$(),[c,g]=i.useState(null),[f,j]=i.useState({}),[v,D]=i.useState([]);i.useEffect(()=>{l&&P(l).then(g)},[l]),i.useEffect(()=>{const t=async()=>{const n={};for(const a of o)n[a.address]||(n[a.address]=await P(a.address));j(n)};o.length>0&&t()},[o]);const b=(t,n,a,p)=>{const d=h=>h*Math.PI/180,r=d(a-t),m=d(p-n),N=Math.sin(r/2)*Math.sin(r/2)+Math.cos(d(t))*Math.cos(d(a))*Math.sin(m/2)*Math.sin(m/2);return 6371*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))};return i.useEffect(()=>{if(!c||Object.keys(f).length===0)return;const t=u().tz(T).startOf("day"),a=o.filter(s=>s.shippedDate?u(s.shippedDate).tz(T).startOf("day").isSame(t):!1).map(s=>{const r=f[s.address];if(!r)return{...s,distance:"Distance not available",rank:"N/A"};const m=b(c.lat,c.lng,r.lat,r.lng);return{...s,distance:isNaN(m)?"Distance not available":m.toFixed(2),rank:null}}),d=[...a.filter(s=>s.distance!=="Distance not available").sort((s,r)=>parseFloat(s.distance)-parseFloat(r.distance)).map((s,r)=>({...s,rank:r+1})),...a.filter(s=>s.distance==="Distance not available")];D(d)},[c,f,o]),v.length===0?e.jsx("p",{className:"text-gray-500 font-medium px-0 py-5",children:"No delivery for today."}):e.jsx(e.Fragment,{children:v.map(t=>{const n=x.find(a=>a.pre_delivery_trackingNo===t.trackingNo);return e.jsxs("div",{className:"my-5 max-w-[325px] border-1 rounded-sm shadow-lg p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500",children:"tracking No"}),e.jsxs("h1",{className:"font-robo tracking-widest",children:[t.trackingNo,e.jsxs("span",{className:"ml-1 font-bold text-indigo-500",children:["[",t.productCodes.length,"]"]})]})]}),e.jsx("div",{children:e.jsxs("h1",{className:"tracking-widest uppercase text-lg font-bold text-red-500",children:["#",t.rank]})})]}),t.priority&&e.jsxs("div",{className:"my-5",children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500 ",children:"Priority No."}),e.jsx("h1",{className:"font-robo tracking-widest",children:t.priority})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500 ",children:"Customer name"}),e.jsx("h1",{className:"font-robo tracking-widest",children:t.customerName})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500",children:"Address"}),e.jsx("h1",{className:"font-robo tracking-widest",children:t.address})]}),e.jsx("div",{className:"border-t border-gray-300",children:e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500",children:"Received by"}),e.jsxs("h1",{className:"font-robo tracking-widest",children:[" ",n?n.pre_delivery_receivedBy:"-"]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"tracking-widest uppercase text-xs text-gray-500",children:"Status"}),e.jsx("h1",{className:"font-robo tracking-widest text-orange-500",children:(()=>{let a="pending";if(n){const p=n.pre_delivery_products.length,d=t.productCodes.length;p===d&&(a="success")}return e.jsx("span",{className:a==="pending"?"text-[#FFA500] capitalize":a==="success"?"text-[#28A745] capitalize":"text-gray-400 capitalize",children:a})})()})]})]})})]},t._id)})})}B.propTypes={data:A.array.isRequired,preDeliveryData:A.array.isRequired};u.extend(O);u.extend(z);u.extend(W);const q="Asia/Manila";function U({data:o,preDeliveryData:x}){const{selectedWarehouse:l}=$(),[c,g]=i.useState(null),[f,j]=i.useState({}),[v,D]=i.useState([]);i.useEffect(()=>{l&&P(l).then(g)},[l]),i.useEffect(()=>{const t=async()=>{const n={};for(const a of o)n[a.address]||(n[a.address]=await P(a.address));j(n)};o.length>0&&t()},[o]);const b=(t,n,a,p)=>{const d=h=>h*Math.PI/180,r=d(a-t),m=d(p-n),N=Math.sin(r/2)*Math.sin(r/2)+Math.cos(d(t))*Math.cos(d(a))*Math.sin(m/2)*Math.sin(m/2);return 6371*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))};return i.useEffect(()=>{if(!c||Object.keys(f).length===0)return;const t=u().tz(q).startOf("day"),a=o.filter(s=>s.shippedDate?u(s.shippedDate).tz(q).startOf("day").isSame(t):!1).map(s=>{const r=f[s.address];if(!r)return{...s,distance:"Distance not available",rank:"N/A"};const m=b(c.lat,c.lng,r.lat,r.lng);return{...s,distance:isNaN(m)?"Distance not available":m.toFixed(2),rank:null}}),d=[...a.filter(s=>s.distance!=="Distance not available").sort((s,r)=>parseFloat(s.distance)-parseFloat(r.distance)).map((s,r)=>({...s,rank:r+1})),...a.filter(s=>s.distance==="Distance not available")];D(d)},[c,f,o]),v.length===0?e.jsx("p",{className:"text-gray-500 font-medium px-0 py-5",children:"No delivery for today."}):e.jsx("div",{className:"table_section mt-5 font-inter w-full",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"-m-1.5 overflow-x-auto",children:e.jsx("div",{className:"p-1.5 min-w-full inline-block align-middle",children:e.jsxs("div",{className:"border rounded-lg divide-y divide-gray-200",children:[e.jsx("div",{className:"py-5 px-4"}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"th-user-table",children:e.jsx("tr",{children:K.map((t,n)=>e.jsx("th",{className:"px-6 py-3",children:t},n))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:v.map((t,n)=>{const a=x.find(p=>p.pre_delivery_trackingNo===t.trackingNo);return e.jsxs("tr",{className:n%2===0?"bg-[#F3F4F6]":"",children:[e.jsxs("td",{className:"td-user-table",children:[t.trackingNo,e.jsxs("span",{className:"ml-1 font-bold text-indigo-500",children:["[",t.productCodes.length,"]"]})]}),e.jsx("td",{className:"td-user-table",children:t.customerName}),e.jsx("td",{className:"td-user-table",children:a?a.pre_delivery_receivedBy:"-"}),e.jsx("td",{className:"max-w-[320px] break-words whitespace-normal px-6 py-4 text-sm font-medium text-gray-800",children:t.address}),e.jsx("td",{className:"status",children:(()=>{let p="pending";if(a){const d=a.pre_delivery_products.length,s=t.productCodes.length;d===s&&(p="success")}return e.jsx("span",{className:p==="pending"?"bg-[#FFA500] text-white px-5 py-1 rounded-full capitalize":p==="success"?"bg-[#28A745] text-white px-5 py-1 rounded-full capitalize":"bg-gray-400 text-white px-5 py-1 rounded-full capitalize",children:p})})()}),e.jsx("td",{className:"td-user-table",children:t.rank}),e.jsx("td",{className:"td-user-table",children:t.priority||" - "})]},t._id)})})]})})]})})})})})}U.propTypes={data:A.array.isRequired,preDeliveryData:A.array.isRequired};u.extend(O);u.extend(z);const _="Asia/Manila",E="https://prics-epod-backend.onrender.com";function ge(){const{user:o}=Y(),[x,l]=i.useState([]),[c,g]=i.useState([]),[f,j]=i.useState([]),[v,D]=i.useState(window.innerWidth<=768),[b,t]=i.useState(!1),[n,a]=i.useState(!1),[p,d]=i.useState(!1),s=b||n||p;i.useEffect(()=>{(async()=>{t(!0);try{const h=o.plateNo,w=await k.get(`${E}/api/shipment/${h}`);l(w.data)}catch(h){console.log(h),M.error("We could not retrieve your shipment data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{t(!1)}})()},[o.plateNo]),i.useEffect(()=>{if(x.length===0)return;(async()=>{a(!0);try{const h=x.map(C=>k.get(`${E}/api/pre-delivery/${C.trackingNo}`)),Z=(await Promise.all(h)).map(C=>C.data);g(Z)}catch(h){console.error("Failed to fetch pre-delivery data:",h),M.error("We could not load your pre-delivery data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{a(!1)}})()},[x]),i.useEffect(()=>{(async()=>{d(!0);try{const h=o.plateNo,w=await k.get(`${E}/api/appointment/${h}`);j(w.data.appointments)}catch(h){console.log(h),M.error("We could not retrieve your appointment data. Please try again later.",{style:{backgroundColor:"#ff4d4d",color:"#fff"}})}finally{d(!1)}})()},[o.plateNo]);const r=u().tz(_).startOf("day"),m=x.filter(y=>y.shippedDate?u(y.shippedDate).tz(_).isSame(r,"day"):!1),N=f.filter(y=>y.appointment_date?u(y.appointment_date).tz(_).isSame(r,"day"):!1);return i.useEffect(()=>{const y=()=>{D(window.innerWidth<=768)};return window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]),e.jsxs("div",{className:"my-5 mx-4",children:[e.jsx(V,{title:"dashboard",description:"Below is an overview of all deliveries, your plate number and your schedule."}),s?e.jsxs("div",{children:[e.jsx(Q,{}),e.jsx(G,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card_section flex flex-col gap-y-5 md:flex-row md:gap-x-2",children:[e.jsxs(L,{className:"max-w-[330px] ",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-center ",children:[e.jsx(F,{className:"font-inter text-base font-medium",children:"Today’s Delivery"}),e.jsx(X,{size:25})]})}),e.jsxs(H,{children:[e.jsx("h1",{className:"text-5xl font-bebas tracking-wider",children:m.length}),e.jsx("p",{className:"text-sm text-[#6c757d] mt-5",children:"Summary of the deliveries scheduled for today, including details such as tracking no., customer name, addresses."})]})]}),e.jsxs(L,{className:"max-w-[330px]",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-center ",children:[e.jsx(F,{className:"font-inter text-base font-medium",children:"Today’s Appointments"}),e.jsx(ee,{size:25})]})}),e.jsxs(H,{children:[e.jsx("h1",{className:"text-5xl font-bebas tracking-wider",children:N.length}),e.jsx("p",{className:"text-sm text-[#6c757d] mt-5",children:"You can view your all appointments in the My Appointment menu."})]})]})]}),v?e.jsx(B,{data:x,preDeliveryData:c}):e.jsx(U,{data:x,preDeliveryData:c})]})]})}export{ge as default};
