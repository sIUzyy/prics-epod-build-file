import{r as l,j as e}from"./index-Chad9CLA.js";import{L as j}from"./loading-spinner-BUHlXXSt.js";import{B as N}from"./BrowserQRCodeReader-CDf4JARu.js";import{d as r,u as v,t as w}from"./timezone-DS7qtbwd.js";import{a as b}from"./index-DW_MHI2K.js";import{H as M}from"./page-heading-rmoYobWP.js";r.extend(v);r.extend(w);const A="https://prics-epod-backend.onrender.com";function T(){const[f,y]=l.useState([]),[d,c]=l.useState(!1),[,m]=l.useState(!1),[x,n]=l.useState(""),u=l.useRef(null),h=async()=>{c(!0),n("");try{const t={video:{facingMode:{exact:"environment"}}};await navigator.mediaDevices.getUserMedia(t);const a=new N;if(!u.current){n("An unexpected error occurred while accessing the video."),c(!1);return}a.decodeFromVideoDevice(void 0,u.current,(o,i)=>{if(o){c(!1);const s=o.getText();g(s),a.reset()}else i&&i.name})}catch(t){console.error("Scanner Initialization Error:",t),n("Camera access is blocked. Please allow camera permissions and try again."),c(!1)}},g=async t=>{var a,o,i;if(m(!0),n(""),!t){n("No appointment ID found. Please try again."),m(!1);return}try{const s=await b.patch(`${A}/api/appointment/${t}/time-out`);s.status===200&&(y([s.data.appointment]),setTimeout(()=>{window.location.reload()},5e3))}catch(s){if(((a=s.response)==null?void 0:a.status)===400){const p=(i=(o=s.response)==null?void 0:o.data)==null?void 0:i.message;n(p==="Time-in must be recorded first"?"Cannot record time-out. Please record time-in first.":p==="Time-out already recorded"?"Time-out has already been recorded for this appointment.":"Failed to update scan. Try scanning again.")}else n("An unexpected error occurred. Please try again.");setTimeout(()=>{window.location.reload()},5e3)}finally{m(!1)}};return e.jsxs("div",{children:[d&&e.jsx("video",{ref:u,className:"w-full my-3 rounded-lg",autoPlay:!0,playsInline:!0}),e.jsx("button",{onClick:h,disabled:d,className:d?"w-full p-3 rounded-md bg-black text-white font-inter font-bold hover:opacity-75 transition-opacity duration-300 2xl:p-4 cursor-progress":"w-full p-3 rounded-md bg-black text-white font-inter font-bold hover:opacity-75 transition-opacity duration-300 2xl:p-4 cursor-pointer",children:d?e.jsxs("div",{className:"flex items-center justify-center gap-x-2",children:[e.jsx("span",{children:"Scanning"}),e.jsx(j,{})]}):"  Scan Barcode"}),x&&e.jsx("p",{className:"text-red-500 text-sm font-bold mt-5 text-center",children:x}),f.map((t,a)=>e.jsxs("div",{className:"my-5",children:[e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Id"}),e.jsx("input",{type:"text",value:t.appointment_id,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Date"}),e.jsx("input",{type:"text",value:r.utc(t.appointment_date).tz("Asia/Manila").format("MMMM D, YYYY"),readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Appointment Time"}),e.jsx("input",{type:"text",value:r.utc(t.appointment_time).tz("Asia/Manila").format("hh:mm A"),readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Plate No."}),e.jsx("input",{type:"text",value:t.plate_no,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Parking Slot"}),e.jsx("input",{type:"text",value:t.parking_slot,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Dock"}),e.jsx("input",{type:"text",value:t.dock,readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Time In"}),e.jsx("input",{type:"text",value:t.time_in?r(t.time_in).format("MMMM D, YYYY hh:mm A"):"N/A",readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("label",{className:"text-sm font-inter text-[#979090]",children:"Time Out"}),e.jsx("input",{type:"text",value:t.time_out?r(t.time_out).format("MMMM D, YYYY hh:mm A"):"N/A",readOnly:!0,className:"p-4 w-full mt-2 rounded-md cursor-not-allowed bg-gray-100 outline-none"})]})]},a))]})}function P(){return e.jsxs("div",{className:"m-5",children:[e.jsx(M,{title:"Time Out",description:"Click the button to scan the driver's barcode for gate pass."}),e.jsx("div",{className:"max-w-[350px]",children:e.jsx(T,{})})]})}export{P as default};
